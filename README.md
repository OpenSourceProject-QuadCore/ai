# ğŸš êµ¬ë¯¸ ë²„ìŠ¤ ì‹¤ì‹œê°„ ë„ì°© ì˜ˆì¸¡ ì‹œìŠ¤í…œ

ì‹¤ì‹œê°„ ë²„ìŠ¤ APIì™€ ë¨¸ì‹ ëŸ¬ë‹ì„ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ ë²„ìŠ¤ ë„ì°© ì˜ˆì¸¡ ì‹œìŠ¤í…œ

ë„ì°© ì •ë³´ csv: https://drive.google.com/file/d/1ZLV32U1Bmip4_lRrz6KijFrbqbm-q3IE/view?usp=drive_link
---

## ğŸ“‹ ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
- [ì£¼ìš” íŠ¹ì§•](#-ì£¼ìš”-íŠ¹ì§•)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ì„¤ì¹˜ ë°©ë²•](#-ì„¤ì¹˜-ë°©ë²•)
- [ì‚¬ìš© ë°©ë²•](#-ì‚¬ìš©-ë°©ë²•)
- [API ë¬¸ì„œ](#-api-ë¬¸ì„œ)
- [ëª¨ë¸ ì„¤ëª…](#-ëª¨ë¸-ì„¤ëª…)
- [ë°ì´í„° êµ¬ì¡°](#-ë°ì´í„°-êµ¬ì¡°)
- [ì„±ëŠ¥](#-ì„±ëŠ¥)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

êµ¬ë¯¸ì‹œ ë²„ìŠ¤ ë„ì°© ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³ , ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ í™œìš©í•˜ì—¬ ë” ì •í™•í•œ ë„ì°© ì‹œê°„ì„ ì˜ˆì¸¡í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

- **í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ**: API ìš°ì„  ì‚¬ìš©, ëŠê¹€ ì‹œ ML ì˜ˆì¸¡ìœ¼ë¡œ ìë™ ì „í™˜
- **ì•™ìƒë¸” ëª¨ë¸**: GradientBoosting + RandomForest + XGBoost
- **ì‹¤ì‹œê°„ ì¶”ì **: ì—¬ëŸ¬ ëŒ€ì˜ ë²„ìŠ¤ë¥¼ ë™ì‹œì— ì¶”ì  ë° ê´€ë¦¬
- **ìë™ ë³µêµ¬**: API ë³µê·€ ì‹œ ìë™ìœ¼ë¡œ API ëª¨ë“œë¡œ ì „í™˜

---

## âœ¨ ì£¼ìš” íŠ¹ì§•

### 1. í•˜ì´ë¸Œë¦¬ë“œ ì˜ˆì¸¡ ëª¨ë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API ëª¨ë“œ   â”‚ â† ê¸°ë³¸ (ê°€ì¥ ì •í™•)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ API ëŠê¹€ (100ì´ˆ)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ML ì˜ˆì¸¡    â”‚ â† 1íšŒ ì˜ˆì¸¡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ì´í›„
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Countdown  â”‚ â† ì¬ì˜ˆì¸¡ ì—†ìŒ (CPU ì ˆì•½)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ API ë³µê·€
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API ëª¨ë“œ   â”‚ â† ìë™ ë³µê·€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ì§€ëŠ¥í˜• ë²„ìŠ¤ ë§¤ì¹­

- ë‹¤ì¤‘ ë²„ìŠ¤ ìë™ ë¶„ë¦¬ ë° ì¶”ì 
- ì •ë¥˜ì¥ í†µê³¼ ê°ì§€
- ìˆœì„œ ë³´ì¡´ (ì¶”ì›” ë°©ì§€)
- Ghost bus ìë™ ì œê±°

### 3. ê³ ê¸‰ Feature Engineering

- **Target Encoding**: routeid, nodeid (CV-aware, data leakage ë°©ì§€)
- **Feature Interaction**: routeidÃ—hour, weatherÃ—temp ë“±
- **One-Hot Encoding**: Top-N ì¹´í…Œê³ ë¦¬ë§Œ ì‚¬ìš© (íš¨ìœ¨ì„±)
- **í†µê³„ Feature**: ë…¸ì„ ë³„/ì •ë¥˜ì¥ë³„ í‰ê·  ì‹œê°„

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Collection                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ë²„ìŠ¤ API    â”‚           â”‚  ê¸°ìƒì²­ API  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                          â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                    â†“                                     â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â”‚  collector.py   â”‚                           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                   â”‚                                     â”‚
â”‚                   â†“                                     â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â”‚ bus_arrivals.csvâ”‚                           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Data Processing                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  data_preprocessing.py                       â”‚      â”‚
â”‚  â”‚  - ë‚ ì”¨ ë³´ê°„                                  â”‚      â”‚
â”‚  â”‚  - ë²„ìŠ¤ ë¶„ë¦¬ (ë‹¤ì¤‘ ë²„ìŠ¤ ì¶”ì )               â”‚      â”‚
â”‚  â”‚  - ì‹¤ì œ ë„ì°© ë¼ë²¨ ìƒì„±                       â”‚      â”‚
â”‚  â”‚  - Feature Engineering                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                   â”‚                                     â”‚
â”‚                   â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  processed_bus_arrivals.csv                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Model Training                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  train_model.py                              â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚  â”‚  â”‚  BusArrivalPredictor               â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - CV-aware Target Encoding        â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - Feature Interactions            â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - Ensemble (GBM+RF+XGB)           â”‚     â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                   â”‚                                     â”‚
â”‚                   â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  models/bus_predictor.pkl                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Real-time Prediction                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  main.py (FastAPI Server)             â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚  â”‚  â”‚  BusTracker                        â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ                 â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - API â†” ML ìë™ ì „í™˜             â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - ë‹¤ì¤‘ ë²„ìŠ¤ ë§¤ì¹­                  â”‚     â”‚      â”‚
â”‚  â”‚  â”‚  - Countdown ê´€ë¦¬                  â”‚     â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                          â”‚
â”‚  API Endpoints:                                         â”‚
â”‚  - POST /api/bus-arrival/batch                         â”‚
â”‚  - GET  /api/buses                                     â”‚
â”‚  - GET  /api/buses/route/{route_id}                   â”‚
â”‚  - GET  /api/buses/station/{node_id}                  â”‚
â”‚  - GET  /api/status                                    â”‚
â”‚  - GET  /api/stats                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ì„¤ì¹˜ ë°©ë²•

### 1. ì €ì¥ì†Œ í´ë¡ 

```bash
git clone https://github.com/OpenSourceProject-QuadCore/ai.git
cd ai
```

### 2. ê°€ìƒí™˜ê²½ ìƒì„±

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

### 3. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
pip install -r requirements.txt
```

### requirements.txt
```txt
fastapi==0.104.1
uvicorn==0.24.0
pandas==2.0.3
numpy==1.24.3
scikit-learn==1.3.2
xgboost==2.0.0
category-encoders==2.6.0
requests==2.31.0
python-multipart==0.0.6
pydantic==2.5.0
```

---

## ğŸ“– ì‚¬ìš© ë°©ë²•

### Step 1: ë°ì´í„° ìˆ˜ì§‘

```bash
# collector.py ì„¤ì •
# - API í‚¤ ì„¤ì •
# - ì •ë¥˜ì¥ ID ì„¤ì •
# - ìˆ˜ì§‘ ì£¼ê¸° ì„¤ì •

python collector.py
```

**ìˆ˜ì§‘ ê¶Œì¥ ê¸°ê°„: ìµœì†Œ 1ì£¼ì¼ ì´ìƒ**

### Step 2: ëª¨ë¸ í•™ìŠµ

```bash
# ê¸°ë³¸ í•™ìŠµ
python train_model.py --cv --ensemble

# ì „ì²˜ë¦¬ ì¬ì‚¬ìš© (ì¬í•™ìŠµ ì‹œ)
python train_model.py --no-preprocess --cv --ensemble

# ì‹¤ì œ ë„ì°© ì‹œê°„ ë¼ë²¨ ì‚¬ìš© (ë” ì •í™•)
python train_model.py --use-actual --cv --ensemble
```

**í•™ìŠµ ì˜µì…˜:**
- `--cv`: êµì°¨ ê²€ì¦ ìˆ˜í–‰ (5-fold)
- `--ensemble`: ì•™ìƒë¸” ëª¨ë¸ ì‚¬ìš© (GBM+RF+XGB)
- `--no-preprocess`: ì „ì²˜ë¦¬ ê±´ë„ˆë›°ê¸°
- `--use-actual`: ì‹¤ì œ ë„ì°© ì‹œê°„ ë¼ë²¨ ì‚¬ìš©

### Step 3: ì„œë²„ ì‹¤í–‰

```bash
# ì‹¤ì‹œê°„ ëª¨ë“œ
python main.py

# ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ (í…ŒìŠ¤íŠ¸ìš©)
python main.py --simulation

# ì»¤ìŠ¤í…€ ì„¤ì •
python main.py --host 0.0.0.0 --port 8000
```

---

## ğŸ“¡ API ë¬¸ì„œ

### ì„œë²„ ì‹œì‘ í›„

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸

#### 1. ë²„ìŠ¤ ë°ì´í„° ì „ì†¡ (Batch)

```http
POST /api/bus-arrival/batch
Content-Type: application/json

[
  {
    "collection_time": "2024-12-06T14:30:00",
    "weekday": "Mon",
    "time_slot": "afternoon",
    "weather": "Clear",
    "temp": 15.0,
    "humidity": 50.0,
    "rain_mm": 0.0,
    "snow_mm": 0.0,
    "nodeid": "GMB130",
    "nodenm": "êµ¬ë¯¸ì—­",
    "routeid": "37050123",
    "routeno": "123",
    "routetp": "ì¼ë°˜",
    "arrprevstationcnt": 5,
    "arrtime": 300,
    "vehicletp": "ëŒ€í˜•"
  }
]
```

#### 2. ì „ì²´ ë²„ìŠ¤ ì¡°íšŒ

```http
GET /api/buses
```

**ì‘ë‹µ:**
```json
[
  {
    "routeid": "37050123",
    "routeno": "123",
    "nodeid": "GMB130",
    "nodenm": "êµ¬ë¯¸ì—­",
    "slot": 0,
    "arrprevstationcnt": 5,
    "arrtime": 280,
    "display_minutes": 4,
    "display_seconds": 40,
    "vehicletp": "ëŒ€í˜•",
    "routetp": "ì¼ë°˜",
    "mode": "api",
    "last_update": "2024-12-06T14:30:00"
  }
]
```

#### 3. ë…¸ì„ ë³„ ì¡°íšŒ

```http
GET /api/buses/route/{route_id}
```

#### 4. ì •ë¥˜ì¥ë³„ ì¡°íšŒ

```http
GET /api/buses/station/{node_id}
```

#### 5. ì„œë²„ ìƒíƒœ

```http
GET /api/status
```

**ì‘ë‹µ:**
```json
{
  "status": "running",
  "mode": "í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ (API ìš°ì„  + ML ë°±ì—…)",
  "total_buses": 15,
  "api_buses": 14,
  "ml_buses": 1,
  "total_predictions": 5,
  "api_to_ml_transitions": 1,
  "avg_predictions_per_bus": 0.33,
  "predictor_loaded": true,
  "historical_data_loaded": true
}
```

#### 6. í†µê³„ ì •ë³´

```http
GET /api/stats
```

---

## ğŸ¤– ëª¨ë¸ ì„¤ëª…

### 1. Feature Engineering

#### Base Features
```python
- arrprevstationcnt: ë‚¨ì€ ì •ë¥˜ì¥ ìˆ˜
- hour, minute: ì‹œê°„ ì •ë³´
- day_of_week: ìš”ì¼ (0-6)
- is_weekend: ì£¼ë§ ì—¬ë¶€
- is_rush_hour: ì¶œí‡´ê·¼ ì‹œê°„ëŒ€ ì—¬ë¶€ (7-9, 17-19ì‹œ)
- weather: ë‚ ì”¨ (Clear, Rain, Snow ë“±)
- temp: ê¸°ì˜¨
- humidity: ìŠµë„
- rain_mm: ê°•ìˆ˜ëŸ‰
- snow_mm: ì ì„¤ëŸ‰
```

#### Statistical Features
```python
- route_avg_time: ë…¸ì„ ë³„ í‰ê·  ë„ì°© ì‹œê°„
- route_std_time: ë…¸ì„ ë³„ í‘œì¤€í¸ì°¨
- station_avg_time: ì •ë¥˜ì¥ë³„ í‰ê·  ë„ì°© ì‹œê°„
- route_hour_avg_time: ë…¸ì„ Ã—ì‹œê°„ëŒ€ë³„ í‰ê· 
```

#### Interaction Features
```python
- routeid_hour: ë…¸ì„  Ã— ì‹œê°„ëŒ€
- vehicletp_rush: ì°¨ì¢… Ã— ì¶œí‡´ê·¼ ì‹œê°„
- weather_temp: ë‚ ì”¨ Ã— ì˜¨ë„ êµ¬ê°„
- routetp_distance: ë²„ìŠ¤ íƒ€ì… Ã— ê±°ë¦¬ êµ¬ê°„
```

#### Domain-specific Features
```python
- time_of_day: ì‹œê°„ëŒ€ êµ¬ë¶„ (ìƒˆë²½/ì•„ì¹¨/ì˜¤í›„/ì €ë…)
- extreme_cold: ê·¹í•œ ì¶”ìœ„ (< 0Â°C)
- extreme_hot: ê·¹í•œ ë”ìœ„ (> 30Â°C)
- rain_level: ê°•ìˆ˜ëŸ‰ ìˆ˜ì¤€ (0/1/2/3)
- bad_weather: ì•…ì²œí›„ ì—¬ë¶€
- avg_time_per_station: ì •ë¥˜ì¥ë‹¹ í‰ê·  ì‹œê°„
```

### 2. Target Encoding (CV-aware)

```python
# routeid, nodeidì— ëŒ€í•´ ì ìš©
# K-Fold CVë¡œ data leakage ë°©ì§€

for fold in cv_folds:
    train_data â†’ í†µê³„ ê³„ì‚°
    validation_data â†’ í†µê³„ ì ìš©
```

**ì¥ì :**
- ë†’ì€ ì¹´ë””ë„ë¦¬í‹° ì²˜ë¦¬
- Overfitting ë°©ì§€
- ì˜ˆì¸¡ ì •í™•ë„ í–¥ìƒ

### 3. Ensemble Model

```python
Ensemble = (GBM + RF + XGB) / 3

GradientBoosting:
  - n_estimators: 200
  - learning_rate: 0.1
  - max_depth: 7
  - subsample: 0.8

RandomForest:
  - n_estimators: 200
  - max_depth: 15
  - max_features: 'sqrt'

XGBoost:
  - n_estimators: 200
  - learning_rate: 0.1
  - max_depth: 7
  - subsample: 0.8
```

**ê° ëª¨ë¸ì˜ ì¥ì :**
- GBM: ìˆœì°¨ì  í•™ìŠµ, ì—ëŸ¬ ë³´ì •
- RF: ë³‘ë ¬ í•™ìŠµ, ê³¼ì í•© ë°©ì§€
- XGBoost: ìµœì í™”ëœ ì„±ëŠ¥, ë¹ ë¥¸ ì†ë„

### 4. í•˜ì´ë¸Œë¦¬ë“œ ì¶”ì  ë¡œì§

```python
class BusMode:
    API = "api"           # API ë°ì´í„° ì‚¬ìš©
    PREDICTED = "predicted"  # ML ì˜ˆì¸¡ ì‚¬ìš©

# ì „í™˜ ê·œì¹™
if last_update > 100s:  # API ëŠê¹€ ê°ì§€
    mode = PREDICTED
    predict_once()
    
if api_reconnected:
    mode = API  # ìë™ ë³µê·€
```

---

## ğŸ“Š ë°ì´í„° êµ¬ì¡°

### ì›ë³¸ ë°ì´í„° (bus_arrivals.csv)

```csv
collection_time,weekday,time_slot,weather,temp,humidity,rain_mm,snow_mm,nodeid,nodenm,routeid,routeno,routetp,arrprevstationcnt,arrtime,vehicletp
2024-12-06T14:30:00,Mon,afternoon,Clear,15.0,50.0,0.0,0.0,GMB130,êµ¬ë¯¸ì—­,37050123,123,ì¼ë°˜,5,300,ëŒ€í˜•
```

### ì „ì²˜ë¦¬ëœ ë°ì´í„° (processed_bus_arrivals.csv)

ì¶”ê°€ ì»¬ëŸ¼:
```python
- bus_index: ë²„ìŠ¤ ê³ ìœ  ID (ë¶„ë¦¬ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìƒì„±)
- hour, minute: ì‹œê°„ ì •ë³´
- day_of_week: ìš”ì¼ (ìˆ«ì)
- is_weekend: ì£¼ë§ ì—¬ë¶€
- is_rush_hour: ì¶œí‡´ê·¼ ì‹œê°„
- actual_arrtime: ì‹¤ì œ ë„ì°© ì‹œê°„ (ë¼ë²¨)
- confidence: ë¼ë²¨ ì‹ ë¢°ë„ (high/medium)
- ... (ê¸°íƒ€ íŒŒìƒ feature)
```

### ëª¨ë¸ ì…ë ¥ Feature (ìµœì¢…)

- **Numeric**: 28ê°œ
- **OneHot**: ê°€ë³€ (Top-N ì¹´í…Œê³ ë¦¬)
- **Target Encoded**: 2ê°œ (routeid, nodeid)
- **Total**: ì•½ 80-150ê°œ (ë°ì´í„°ì— ë”°ë¼ ë³€ë™)

---

## ğŸ“ˆ ì„±ëŠ¥

### ì˜ˆìƒ ì„±ëŠ¥ ì§€í‘œ

```
MAE (Mean Absolute Error):
  API ë¼ë²¨: ~120ì´ˆ
  ì‹¤ì œ ë¼ë²¨: ~85ì´ˆ

RMSE:
  API ë¼ë²¨: ~180ì´ˆ
  ì‹¤ì œ ë¼ë²¨: ~125ì´ˆ

RÂ²:
  API ë¼ë²¨: ~0.75
  ì‹¤ì œ ë¼ë²¨: ~0.85
```

### ì‹œìŠ¤í…œ íš¨ìœ¨ì„±

```
í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ:
  - API ì•ˆì • (95%): 0 predictions/bus
  - API ëŠê¹€ (5%): 1 prediction/bus
  - í‰ê·  CPU: ~5%
  
Complete ML ëª¨ë“œ (ë¹„êµ):
  - ëª¨ë“  ë²„ìŠ¤: 1 prediction/bus
  - í‰ê·  CPU: ~8%
  
Original ëª¨ë“œ (ë¹„êµ):
  - 60ì´ˆë§ˆë‹¤ ì¬ì˜ˆì¸¡: 10-20 predictions/bus
  - í‰ê·  CPU: ~45%
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 422 Validation Error

**ì›ì¸**: None ê°’ì´ ì„œë²„ë¡œ ì „ì†¡ë¨

**í•´ê²°**:
```python
# collector.pyì—ì„œ ê¸°ë³¸ê°’ ë³´ì¥
row_copy['weather'] = str(row_copy.get('weather') or 'Unknown')
row_copy['temp'] = float(row_copy.get('temp') if row_copy.get('temp') is not None else 15.0)
```

### ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨

**ì›ì¸**: scikit-learn ë²„ì „ ë¶ˆì¼ì¹˜

**í•´ê²°**:
```bash
pip install scikit-learn==1.3.2
```

### Historical fallback KeyError

**ì›ì¸**: processed_bus_arrivals.csvì— hour ì»¬ëŸ¼ ì—†ìŒ

**í•´ê²°**: ìë™ìœ¼ë¡œ ìƒì„±ë¨ (main.pyì—ì„œ ì²˜ë¦¬)

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
bus-prediction/
â”œâ”€â”€ collector.py                 # ë°ì´í„° ìˆ˜ì§‘
â”œâ”€â”€ data_preprocessing.py        # ì „ì²˜ë¦¬
â”œâ”€â”€ bus_predictor.py            # ëª¨ë¸ í´ë˜ìŠ¤
â”œâ”€â”€ bus_tracker.py              # ë²„ìŠ¤ ì¶”ì  (í•˜ì´ë¸Œë¦¬ë“œ)
â”œâ”€â”€ train_model.py              # ëª¨ë¸ í•™ìŠµ
â”œâ”€â”€ main.py              # FastAPI ì„œë²„
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ bus_arrivals.csv        # ì›ë³¸ ë°ì´í„°
â”‚   â””â”€â”€ processed_bus_arrivals.csv  # ì „ì²˜ë¦¬ëœ ë°ì´í„°
â”œâ”€â”€ models/
â”‚   â””â”€â”€ bus_predictor.pkl       # í•™ìŠµëœ ëª¨ë¸
â””â”€â”€ requirements.txt            # ì˜ì¡´ì„±
```
## ğŸ‘¨â€ğŸ’» ê°œë°œì

**ë°•ì§€í˜¸** - ë”¥ëŸ¬ë‹ ê³¼ì • ìµœì¢… í”„ë¡œì íŠ¸
